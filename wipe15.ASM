org 100h
call GetDiskPar
CALL INTRO
CALL SHOW_MAX_SECTOR
CALL ESPACOS
CALL BYTESPS
CALL ESPACOS
CALL GET_SECTOR_SIZE
Start:
mov eax,4000h
mov es,ax
es
cmp dword[10h],0
jle End1
call WipeHDD
mov eax,60H
ss
add dword[SETOR],eax
es
mov eax,60H
ss
add dword[SECTOR2],eax
es
sub dword[10h],60H
jmp Start
End1:
CALL QUEBRA_DE_LINHA
CALL ENDING
ret
WipeHDD:
mov eax,0
mov ecx,3000H
push es
mov esi,4000h
mov es,si
mov edi,600h
rep stosd
pop es
mov al,10h
mov si,300h
mov al,10h
mov [si],al
mov al,0h
mov [si+1],al
mov al,60H
mov [si+2],al
mov al,0h
mov [si+3],al
mov ax,600h
mov [si+4],ax
mov ax,4000h
mov [si+6],ax
ss
mov eax,[SETOR]  ;SETOR A SER GRAVADO
mov [si+8],eax
xor ax,ax
mov [si+0ch],ax
mov [si+0eh],ax
mov ah,43h
mov dl,80h
INT 13h
ret

GetDiskPar:
mov ah,48h
mov dl,80h
push ds
mov bx,4000h
mov ds,bx
xor si,si
INT 13h
pop ds
ret

SHOW_MAX_SECTOR:
JMP FIM
SECTORS:
MOV SI,4
LABEL1:
MOV DL,[DS:BP+0]
AND DL,0F0H
MOV AH,2H
MOV CL,4
SHR DL,CL
ADD DL,30H
CMP DL,3AH
JL INT21
ADD DL,7
INT21:
INT 21H
MOV AH,2
MOV DL,[DS:BP+0]
AND DL,0FH
ADD DL,30H
CMP DL,3AH
JL INTDOS
ADD DL,7
INTDOS:
INT 21H
DEC SI
DEC BP
CMP SI,0
JNZ LABEL1
MOV DX,13
MOV AH,2
INT 21H
MOV DX,10
MOV AH,2
INT 21H
MOV DX,0
MOV AH,2
INT 21H
RET
FIM:
CALL GetDiskPar
MOV AX,4000h
MOV DS,AX
MOV BP,13H
JMP SECTORS
RET


SPACE:
MOV AH,2
MOV DL,20h
INT 21h
RET

INTRO:
MOV AH,9
MOV DX,INTROS
INT 21H
RET
ENDING:
MOV AH,9
MOV DX,ENDINGS
INT 21h
RET

QUEBRA_DE_LINHA:

PUSH DS
MOV AX,ES
MOV DS,AX
MOV AH,9
MOV DX,NEWL
INT 21h
POP DS
RET

BYTESPS:

PUSH DS
MOV AX,ES
MOV DS,AX
MOV AH,9
MOV DX,BPS
INT 21h
POP DS
RET

ESPACOS:
PUSH DS
MOV AX,ES
MOV DS,AX
MOV AH,9
MOV DX,SPACE0
INT 21h
POP DS
RET

RETORNO:
PUSH DS
MOV AX,ES
MOV DS,AX
MOV AH,2
MOV DX,RETORNO2
INT 21h
POP DS
RET

SHOW_BYTES_PER_SECTOR:
PUSH DS
MOV AX,ES
MOV DS,AX
MOV AH,2
MOV DX,BPS
INT 21h
POP DS
RET

GET_SECTOR_SIZE:
JMP FIM00
SECTORS00:
MOV SI,2
LABEL00:
MOV DL,[DS:BP+0]
AND DL,0F0H
MOV AH,2H
MOV CL,4
SHR DL,CL
ADD DL,30H
CMP DL,3AH
JL INT2100
ADD DL,7
INT2100:
INT 21H
MOV AH,2
MOV DL,[DS:BP+0]
AND DL,0FH
ADD DL,30H
CMP DL,3AH
JL INTDOS00
ADD DL,7
INTDOS00:
INT 21H
DEC SI
DEC BP
CMP SI,0
JNZ LABEL00
RET
FIM00:
CALL GetDiskPar
MOV AX,4000h
MOV DS,AX
MOV BP,19H
JMP SECTORS00
RET

SECTOR_SIZE DW 0
SETOR DD 0
SECTOR2 DD 0
RETORNO2 DB 0Ah
SPACES DD 0


INTROS DB "TOTAL DE SETORES EM HEXADECIMAL PARA SEREM WIPEDS: $",13,10,13,10,0
BPS DB "TAMANHO DOS SETORES EM HEXADECIMAL: $",13,10,13,10,0
ENDINGS DB "DISCO WIPED$",0
NEWL DB 0,0,13,10,0,0,"$"
SPACE0 DB " $"
